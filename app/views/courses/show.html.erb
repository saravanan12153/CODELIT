<!-- Page Title-->
<div class="row wrapper border-bottom white-bg page-heading">
  <div class="col-lg-10">
    <h2><%= @course.title %></h2>
    <ol class="breadcrumb">
      <li>
        <a href="<%= courses_path %>">Courses</a>
      </li>
      <li class="active">
        <strong><%= @course.title %></strong>
      </li>
    </ol>
  </div>
</div>

<div class="wrapper wrapper-content animated fadeIn">
  <div class="row">
    <div class="col-lg-12">
      <div class="ibox float-e-margins">
        <div class="ibox-title">
          <h5><%= @course.title %> <small class="m-l-sm"><%= @course.subtitle %></small></h5>
        </div>
        <div class="ibox-content">
          <div class="tabs-container">
            <ul class="nav nav-tabs">
              <% unless @course.promo.empty? %>
              <li class="active"><a id="t1" data-toggle="tab" href="#tab-1">Promo</a></li>
              <% end %>
              <li class=""><a id="t2" data-toggle="tab" href="#tab-2">Description</a></li>
              <li class=""><a id="t3" data-toggle="tab" href="#tab-3">Get Course</a></li>
            </ul>
            <div class="tab-content">
              <% unless @course.promo.empty? %>
              <div id="tab-1" class="tab-pane active">
                <div class="panel-body">
                  <figure class="embed-responsive embed-responsive-16by9">
                    <%= display(@course.promo) %>
                  </figure>
                </div>
              </div>
              <% end %>
              <div id="tab-2" class="tab-pane">
                <div class="panel-body">
                  <%= raw @course.description %>
                </div>
              </div>
              <div id="tab-3" class="tab-pane">
                <div class="panel-body">
                  <% if user_signed_in? %>
                    <%= render 'coupon' %>
                  <% else %>
                    <div class="text-center">
                      <%= link_to "Log In/Sign Up To Continue", new_user_session_path, class: "btn btn-primary" %>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<br>
<br>


<% content_for :javascript do %>
  <script src="https://js.braintreegateway.com/v2/braintree.js"></script>
  <script type="text/javascript">

    var clientToken = "<%= Braintree::ClientToken.generate %>";
    braintree.setup(clientToken, "dropin", {
      container: "dropin",
      paypal: {
        singleUse: true,
        currency: 'EUR',
        locale: 'en_us'
      },
      dataCollector: {
        paypal: true  // Enables fraud prevention
      }
    });
    $(document).ready(function () {


      // Adding responsive class to lecture video
      $("iframe").addClass("embed-responsive-item");
      <% if @course.promo.empty? %>
      jQuery('#tab-2').addClass('active');
      jQuery('#tab-3').removeClass('active');
      jQuery('#tab-1').removeClass('active');
      jQuery('#t2').parent('li').addClass('active');
      jQuery('#t3').parent('li').removeClass('active');
      jQuery('#t1').parent('li').removeClass('active');
      <% end %>
      <% if params[:coupon].present? %>
        jQuery('#tab-3').addClass('active');
        jQuery('#tab-2').removeClass('active');
        jQuery('#tab-1').removeClass('active');
        jQuery('#t3').parent('li').addClass('active');
        jQuery('#t2').parent('li').removeClass('active');
        jQuery('#t1').parent('li').removeClass('active');
        <% if user_signed_in? %>
          <% if @coupon.present? && @coupon.total > 0 %>
            toastr['success']('Coupon added successfully');
          <% else %>
            toastr['error']('Invalid or Expired Coupon!');
          <% end %>
        <% else %>
          toastr['error']('Please Log In to continue!');
        <% end %>
      <% end %>

    });

    // making lecture video full screen
    $(document).on('webkitfullscreenchange mozfullscreenchange fullscreenchange', function (e) {
      $('body').hasClass('fullscreen-video') ? $('body').removeClass('fullscreen-video') : $('body').addClass('fullscreen-video')
    });


  </script>
<% end %>
